---
title: "Experimentando o R 4.1.0"
excerpt: "Primeiras impressões ao usar o nova versão do R"
author: "Beatriz Milz"
categories:
  - RStudio
  - R
  - Pipe
date: 2021-05-18
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>
<link href="{{< blogdown/postref >}}index_files/panelset/panelset.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index_files/panelset/panelset.js"></script>


<div id="introdução" class="section level2">
<h2>Introdução</h2>
<p>A versão do 4.1.0 do R foi lançada <strong>hoje</strong> (dia 18 de maio de 2021), e a comunidade está bem animada com a chegada do pipe <code>|&gt;</code> no R base!</p>
<p>Esse post <strong>não</strong> tem como objetivo explicar quais foram as mudanças, e sim para apenas mostrar as primeiras impressões ao usar <strong>a versão 4.1.0</strong>! Caso você queira saber mais sobre as mudanças, recomendo esses textos:</p>
<ul>
<li><p><a href="https://blog.curso-r.com/posts/2021-05-06-o-novo-pipe-esta-chegando/">Post “R 4.1: o novo pipe está chegando!”, por Caio Lente, da Curso-R</a></p></li>
<li><p><a href="https://www.jumpingrivers.com/blog/new-features-r410-pipe-anonymous-functions/">Post “New features in R 4.1.0”, blog da jumping rivers</a></p></li>
<li><p><em>edit</em>: <a href="https://www.youtube.com/watch?v=6SZc4v0FDTw">Video por Samuel Macêdo: Qual a diferença entre o pipe do magrittr e o do R base?</a></p></li>
</ul>
<p>Além disso, amanhã acontecerá uma live no canal do Youtube da Curso-R (e eu pretendo participar):</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RPSLFU_5OGk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</center>
</div>
<div id="atalho-do-pipe-no-rstudio" class="section level2">
<h2>Atalho do pipe no RStudio</h2>
<p>Além de atualizar a versão do R para 4.1.0 (<a href="https://www.r-project.org/">veja mais aqui</a>), eu também atualizei a versão do RStudio para a preview (<a href="https://www.rstudio.com/products/rstudio/download/preview/">veja mais aqui</a>).</p>
<p>A versão preview apresenta a opção de atalho para o novo pipe, seguindo os passos: Tools &gt; Global Options &gt; Code &gt; Use native pipe operator.</p>
<p><img src="https://beatrizmilz.com/img/atalho_rstudio_novo_pipe.png" /><!-- --></p>
<p>Ativando essa opção, é possível usar o mesmo atalho de costume para escrever o pipe do R base: <code>Ctrl</code> + <code>Shift</code> + <code>M</code>!</p>
</div>
<div id="exemplos" class="section level2">
<h2>Exemplos!</h2>
<p>Para experimentar, resolvi tentar adaptar os exemplos apresentados no <a href="https://livro.curso-r.com/6-1-o-operador-pipe.html">capítulo sobre o operador pipe</a>, do livro <a href="https://livro.curso-r.com/index.html">Ciência de Dados em R</a>, da qual sou contribuidora!</p>
<p><a href='https://livro.curso-r.com/index.html'>
<img src="https://curso-r.com/images/produtos/hex-livro.png" width="30%" style="display: block; margin: auto;" />
</a></p>
<p>Como vou apresentar o código original mostrado no livro (usando o pipe do <code>{magrittr}</code>) e a adaptação com pipe do R base, é necessário carregar o pipe do pacote <code>{magrittr}</code> para que os exemplos a seguir funcionem:</p>
<pre class="r"><code># Esse argumento include.only é útil nesse caso,
# pois apenas a função %&gt;% é carregada
library(magrittr, include.only = &quot;%&gt;%&quot;)</code></pre>
<p>O primeiro exemplo do livro mostra algumas equivalências, e adiciono então uma terceira linha, mostrando a equivalência com o pipe do R base: substituimos o <code>%&gt;%</code> do <code>{magrittr}</code>, pelo <code>|&gt;</code> do R base!</p>
<pre class="r"><code>f(x, y) # sem o pipe
x %&gt;% f(y) # com o pipe do magrittr
x |&gt; f(y) # com o pipe do R base</code></pre>
</div>
<div id="exemplo-1" class="section level2">
<h2>Exemplo 1</h2>
<p>No primeiro exemplo, apenas foi necessário substituir o pipe do magrittr <code>%&gt;%</code> pelo pipe do R base <code>|&gt;</code>:</p>
<p>Exemplo do livro:</p>
<blockquote>
<p>Vamos calcular a raiz quadrada da soma dos valores de 1 a 4. Primeiro, sem o pipe.</p>
</blockquote>
<pre class="r"><code>x &lt;- c(1, 2, 3, 4)</code></pre>
</div>
<div class="panelset">
<div id="sem-pipe" class="section level2 sem-pipe panel">
<h2>Sem pipe</h2>
<pre class="r"><code># Versão original do livro, sem usar o pipe
sqrt(sum(x))</code></pre>
<pre><code>## [1] 3.162278</code></pre>
</div>
<div id="pipe-magrittr" class="section level2 pipe-magrittr panel">
<h2>Pipe magrittr</h2>
<pre class="r"><code># Versão original do livro, com o pipe do magrittr
x %&gt;% sum() %&gt;% sqrt()</code></pre>
<pre><code>## [1] 3.162278</code></pre>
</div>
<div id="versão-adaptada-com-pipe-do-r-base" class="section level2 pipe-nativo panel">
<h2>Versão adaptada com pipe do R base</h2>
<pre class="r"><code># Versão usando o pipe do R base
x |&gt; sum() |&gt; sqrt()</code></pre>
<pre><code>## [1] 3.162278</code></pre>
</div>
</div>
<p>Foi tranquilo!</p>
<div id="exemplo-2" class="section level2">
<h2>Exemplo 2</h2>
<p>Neste próximo exemplo, não basta fazer a substituição feita no exemplo anterior. Isso acontece porque o pipe do magrittr aceita utilizar o ponto <code>.</code> (chamado de <em>dot placeholder</em> em inglês) para indicar onde o resultado recebido pelo pipe será substituído na próxima operação. Por outro lado, o pipe do R base não aceita essa forma.</p>
<p>Como o exemplo do livro utiliza o ponto <code>.</code>, isso teve que ser adaptado para que o código funcionasse! Essa adaptação ocorreu utilizando outra grande novidade do R 4.1.0: <strong>as funções anônimas</strong>: <code>\(x)</code>. Meu objetivo não é explicar aqui, mas recomendo fortemente que leia <a href="https://blog.curso-r.com/posts/2021-05-06-o-novo-pipe-esta-chegando/">texto do Caio Lente</a>, pois lá tem uma seção inteira sobre esse tema.
Sinceramente não foi de primeira que eu acertei o uso da função anônima no exemplo abaixo, mas depois de olhar alguns outros exemplos, deu certo!</p>
<p>Exemplo do livro:</p>
<blockquote>
<p>Queremos que o dataset seja recebido pelo segundo argumento (data=) da função “lm”.</p>
</blockquote>
</div>
<div class="panelset">
<div id="versão-original-do-livro" class="section level2 pipe-magrittr panel">
<h2>Versão original do livro</h2>
<pre class="r"><code># Versão original do livro usando o pipe do magrittr
airquality %&gt;%
  na.omit() %&gt;%
  lm(Ozone ~ Wind + Temp + Solar.R, data = .) %&gt;%
  summary()</code></pre>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ Wind + Temp + Solar.R, data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -40.485 -14.219  -3.551  10.097  95.619 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -64.34208   23.05472  -2.791  0.00623 ** 
## Wind         -3.33359    0.65441  -5.094 1.52e-06 ***
## Temp          1.65209    0.25353   6.516 2.42e-09 ***
## Solar.R       0.05982    0.02319   2.580  0.01124 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21.18 on 107 degrees of freedom
## Multiple R-squared:  0.6059, Adjusted R-squared:  0.5948 
## F-statistic: 54.83 on 3 and 107 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="versão-adaptada-com-pipe-do-r-base-1" class="section level2 pipe-nativo panel">
<h2>Versão adaptada com pipe do R base</h2>
<pre class="r"><code># Versão usando o pipe do R base + funções anônimas
airquality |&gt;
  na.omit()  |&gt;
  {\(x) lm(formula = Ozone ~ Wind + Temp + Solar.R, data = x)}() |&gt;
  summary()</code></pre>
<pre><code>## 
## Call:
## lm(formula = Ozone ~ Wind + Temp + Solar.R, data = x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -40.485 -14.219  -3.551  10.097  95.619 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -64.34208   23.05472  -2.791  0.00623 ** 
## Wind         -3.33359    0.65441  -5.094 1.52e-06 ***
## Temp          1.65209    0.25353   6.516 2.42e-09 ***
## Solar.R       0.05982    0.02319   2.580  0.01124 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21.18 on 107 degrees of freedom
## Multiple R-squared:  0.6059, Adjusted R-squared:  0.5948 
## F-statistic: 54.83 on 3 and 107 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div id="conclusão" class="section level2">
<h2>Conclusão</h2>
<p>É muito legal ver que a linguagem está desenvolvendo e incorporando contribuições que surgiram das demandas da comunidade! Muito empolgante testar coisas novas. Caso você também esteja animada(o), <a href="https://www.youtube.com/embed/RPSLFU_5OGk">assista a live da Curso-R sobre o tema</a>!</p>
<p>Lembrando que os códigos acima utilizando o pipe do R base e as notações das funções anônimas apenas funcionarão se você instalou a nova versão do R: 4.1.0!</p>
<p>Essas são as informações relacionadas à plataforma que estou usando, e a versão do R:</p>
<pre class="r"><code>sessioninfo::session_info()$platform</code></pre>
<pre><code>##  setting  value                                      
##  version  R version 4.1.0 Patched (2021-05-19 r80340)
##  os       macOS Big Sur 11.3.1                       
##  system   aarch64, darwin20                          
##  ui       X11                                        
##  language (EN)                                       
##  collate  en_US.UTF-8                                
##  ctype    en_US.UTF-8                                
##  tz       America/Sao_Paulo                          
##  date     2021-06-04</code></pre>
</div>
